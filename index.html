<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Naveo FSM</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#003366"/>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#f5f7fa;margin:0;display:grid;place-items:center;height:100vh}
    .card{background:#fff;padding:1.25rem 1.5rem;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.08);min-width:320px;text-align:center}
    h1{margin:.2rem 0;color:#003366}
    p{color:#555;margin:.5rem 0 1rem}
    a.btn{display:inline-block;background:#003366;color:#fff;text-decoration:none;padding:.6rem 1rem;border-radius:8px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Naveo FSM</h1>
    <p id="status">Checking sessionâ€¦</p>
    <a class="btn" href="login.html" id="loginBtn" style="display:none">Log in</a>
  </div>

  <script src="config.js"></script>
  <script src="auth.js"></script>
  <script>
    (async function(){
      try {
        const user = Auth.getSession();
        if(!user){ document.getElementById('loginBtn').style.display='inline-block'; document.getElementById('status').textContent='Please log in.'; return; }
        // Route by role
        if(user.role === 'planner'){
          location.replace('planner/index.html'); // optional planner app
        }else{
          location.replace('assigned-jobs.html'); // your technician list page
        }
      }catch(e){
        document.getElementById('status').textContent='Session invalid. Please log in.';
        document.getElementById('loginBtn').style.display='inline-block';
      }
    })();
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js'); }
  </script>
</body>
</html>
