import { validateLogin, saveSession } from './assets/js/auth.js';

document.getElementById('loginForm').onsubmit = async function(e) {
  e.preventDefault();
  const role = document.getElementById('role').value;
  const email = document.getElementById('email').value.trim();
  const pwd = document.getElementById('pwd').value;
  const err = document.getElementById('errorMsg');
  err.style.display = "none";
  if (!role || !email || !pwd) {
    err.textContent = "All fields are required."; err.style.display = "block"; return;
  }

  // --- SheetDB Live Auth ---
  const user = await validateLogin(role, email, pwd);
  if (user) {
    saveSession(role, email, user);
    if (role === "planner") location.href = "planner/planner.html";
    else if (role === "technician") location.href = "technician/assigned-jobs.html";
    else location.href = "index.html";
  } else {
    err.textContent = "Invalid credentials or inactive account.";
    err.style.display = "block";
  }
};
