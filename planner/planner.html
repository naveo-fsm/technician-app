<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Planner â€¢ Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="../assets/js/noco.js"></script>
  <script src="../assets/js/auth-lite.js"></script>
  <style>
    :root{--primary:#0056b3;--bg:#f5f7fb;--card:#fff;--border:#e5e7eb}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);font-family:Poppins,Arial,sans-serif}
    header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#fff;border-bottom:1px solid var(--border)}
    h1{font-size:18px;margin:0}
    .container{padding:16px;display:grid;gap:16px}
    .card{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.05);padding:16px}
    .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .kpi{padding:14px;border:1px solid var(--border);border-radius:12px}
    .kpi h3{margin:0 0 6px;font-size:12px;color:#6b7280} .kpi div{font-size:28px;font-weight:700}
    .links{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    a.btn{display:block;text-align:center;padding:12px;border-radius:10px;background:#e9eef7;color:#111;text-decoration:none;border:1px solid var(--border)}
    @media(max-width:960px){ .kpis,.links{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <script>Auth.ensureRole(['planner']);</script>

  <header>
    <h1>Planner Hub</h1>
    <div></div>
  </header>
  <script>document.addEventListener('DOMContentLoaded', ()=> Auth.injectRoleBadge('header'));</script>

  <main class="container">
    <section class="card">
      <h2 style="margin:0 0 10px;font-size:16px;">Today</h2>
      <div class="kpis">
        <div class="kpi"><h3>Assigned</h3><div id="c_ass">0</div></div>
        <div class="kpi"><h3>In Progress</h3><div id="c_prog">0</div></div>
        <div class="kpi"><h3>Completed</h3><div id="c_comp">0</div></div>
      </div>
    </section>

    <section class="card">
      <h2 style="margin:0 0 10px;font-size:16px;">Quick Links</h2>
      <div class="links">
        <a class="btn" href="./planner-jobs.html">Jobs</a>
        <a class="btn" href="./assign-job-enhanced.html">Assign SO</a>
        <a class="btn" href="./dashboard.html">Dashboard</a>
        <a class="btn" href="./realtime-map.html">Live Map</a>
        <a class="btn" href="./assign-inventory-selector.html">Assign Inventory</a>
        <a class="btn" href="./planner-inventory.html">Inventory Usage</a>
        <a class="btn" href="./admin-intervention-master.html">Interventions/Checklists</a>
        <a class="btn" href="./admin-tech-master.html">Technicians</a>
        <a class="btn" href="./history.html">Status History</a>
        <a class="btn" href="./reports.html">Reports</a>
      </div>
    </section>
  </main>

  <script>
    const { T } = NC, api = NCAPI, U = NCUTIL;
    async function hubCounts(){
      const today = new Date(); const from = new Date(today); from.setHours(0,0,0,0);
      const to = new Date(today); to.setHours(23,59,59,999);
      const q = (st)=> `filter=(status,eq,${st})&filter=(scheduled_at,between,${U.iso(from)},${U.iso(to)})&limit=1`;
      const [ass, prog, comp] = await Promise.all([
        api.list(T.service_orders, q('assigned')),
        api.list(T.service_orders, q('in_progress')),
        api.list(T.service_orders, q('completed')),
      ]);
      set('#c_ass', ass.pageInfo?.totalRows ?? ass.list.length);
      set('#c_prog', prog.pageInfo?.totalRows ?? prog.list.length);
      set('#c_comp', comp.pageInfo?.totalRows ?? comp.list.length);
    }
    function set(sel, v){ const e=document.querySelector(sel); if(e) e.textContent=v; }
    document.addEventListener('DOMContentLoaded', hubCounts);
  </script>
</body>
</html>
