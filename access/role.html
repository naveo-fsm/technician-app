<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Naveo FSM – Choose Role</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Note the relative paths from /access/ -->
  <script src="../assets/js/noco.js"></script>
  <script src="../assets/js/auth-lite.js"></script>
  <style>
    :root{--primary:#0056b3;--bg:#f5f7fb;--card:#fff;--border:#e5e7eb}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:Poppins, Arial, sans-serif}
    .wrap{max-width:720px;margin:12vh auto;background:var(--card);border:1px solid var(--border);
          border-radius:16px;box-shadow:0 16px 40px rgba(0,0,0,.06);padding:24px}
    h1{margin:0 0 8px;font-size:22px}
    p{margin:0 0 14px;color:#6b7280}
    .card{border:1px solid var(--border);border-radius:12px;padding:12px;margin-top:10px}
    .btn{display:inline-block;background:var(--primary);color:#fff;text-decoration:none;padding:10px 16px;border-radius:10px;margin:4px;border:none;cursor:pointer}
    .btn.secondary{background:#e9eef7;color:#111}
    label{font-weight:600;font-size:.9rem}
    select{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Choose your role</h1>
    <p>We don’t use passwords here — just pick a role to continue.</p>

    <div class="card">
      <h3 style="margin:0 0 6px">Planner</h3>
      <p class="muted">Access job assignment, dashboards, live map, and reports.</p>
      <button class="btn" id="goPlanner">Enter Planner</button>
    </div>

    <div class="card">
      <h3 style="margin:0 0 6px">Technician</h3>
      <label for="techId">Select Technician</label>
      <select id="techId"></select>
      <div style="margin-top:8px">
        <button class="btn" id="goTech">Enter Technician</button>
        <span id="techMsg" style="margin-left:8px;color:#0056b3"></span>
      </div>
    </div>

    <div style="margin-top:12px">
      <a class="btn secondary" href="../index.html">Back to Home</a>
    </div>
  </div>

  <script>
    const { T } = NC, api = NCAPI;
    const BASE_PATH = Auth.BASE_PATH || '';

    // Load technicians for the dropdown
    async function loadTechs(){
      try{
        const res = await api.list(T.technicians, 'limit=2000&sort=full_name');
        const opt = res.list.map(t => `<option value="${t.id}">${t.full_name || ('Tech #'+t.id)}</option>`).join('');
        document.getElementById('techId').innerHTML = opt || '<option value="">(no techs)</option>';
      }catch(e){
        document.getElementById('techId').innerHTML = '<option value="">(error loading)</option>';
        console.error(e);
      }
    }

    document.getElementById('goPlanner').onclick = ()=>{
      Auth.setRole('planner');
      window.location.href = `${BASE_PATH}/planner/planner-jobs.html`;
    };

    document.getElementById('goTech').onclick = ()=>{
      const sel = document.getElementById('techId');
      const id = parseInt(sel.value, 10);
      const name = sel.options[sel.selectedIndex]?.text || '';
      if(!Number.isFinite(id)){ document.getElementById('techMsg').textContent = 'Please select a technician'; return; }
      Auth.setRole('technician', { id, name });
      window.location.href = `${BASE_PATH}/technician/home.html`;
    };

    document.addEventListener('DOMContentLoaded', loadTechs);
  </script>
</body>
</html>
